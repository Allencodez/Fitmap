<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="../Assets/fontawesome-free-7.0.0-web/css/all.css"
    />
    <link rel="stylesheet" href="../style.css" />
  </head>
  <body>
    <section>
      <div class="login-page">
        <div class="sign-in">
          <img
            class="lo-gos"
            src="../Assets/images/Rectangle 1.png"
            alt="Image"
          />
          <p class="lo-gos-name">Fit Map</p>
          <p id="sign-in-text">Sign into your Account</p>
        </div>

        <div>
          <div class="login-wrap">
            <label class="login-name" data-i18n="your_email">Email</label>
          </div>
          <div>
            <input
              id="si-email"
              class="login-p-text"
              type="email"
              data-i18n="your_email"
              placeholder="solotech283@gmail.com"
            />
          </div>
        </div>

        <div>
          <div>
            <label class="login-p-name" data-i18n="password">Password</label>
          </div>

          <div>
            <input
              id="si-pass"
              class="login-p-text"
              type="password"
              data-i18n="password"
              placeholder="********"
            />
          </div>
        </div>

        <div class="login-checks">
          <a href="forgotpass.html"
            ><div class="labels">Forgot Password</div></a
          >
        </div>

        <div class="signin">
          <div class="sign-in-btn">
            <button id="signinBtn" disabled data-i18n="save_changes">
              Sign In
            </button>
          </div>
        </div>
        <p
          id="signinMsg"
          class="validation-msg"
          style="
            display: none;
            color: #666;
            font-family: poppins;
            font-size: 0.9rem;
            margin-top: 8px;
          "
          aria-live="polite"
        >
          Please enter your name and password to enable Sign In.
        </p>

        <div class="create-account">
          <div class="account-line"></div>
          <p class="account-text">Or Create account with</p>
        </div>

        <div>
          <div class="btn-wrap">
            <button><i class="fab fa-apple"></i>Apple</button>
            <button class="icon-btn">
              <img
                class="icon"
                src="../Assets/Icons/icons8-google-48.png"
                alt="#"
              />
              Google
            </button>
          </div>

          <div class="last-text">
            <p>Don't have an Account? <a href="sign-up.html">Create One</a></p>
          </div>
        </div>
      </div>
    </section>
  </body>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const emailInput = document.getElementById("si-email");
      const passInput = document.getElementById("si-pass");
      const btn = document.getElementById("signinBtn");
      const signinMsg = document.getElementById("signinMsg");

      function showMsg(text, color = "red") {
        if (!signinMsg) return;
        signinMsg.style.display = "block";
        signinMsg.style.color = color;
        signinMsg.textContent = text;
      }

      function validate() {
        const emailVal = emailInput ? emailInput.value.trim() : "";
        const passVal = passInput ? passInput.value.trim() : "";
        const emailFormatOk = /^\S+@\S+\.\S+$/.test(emailVal);

        let stored = null;
        try {
          const raw = localStorage.getItem("fitmap_user");
          stored = raw ? JSON.parse(raw) : null;
        } catch (e) {
          stored = null;
        }

        if (!stored) {
          btn.disabled = true;
          showMsg("No account found. Please sign up first.");
          return;
        }

        if (!emailFormatOk) {
          btn.disabled = true;
          showMsg("Enter a valid email address.");
          return;
        }

        if (emailVal.toLowerCase() !== (stored.email || "").toLowerCase()) {
          btn.disabled = true;
          showMsg("We can't find an account with that email.");
          return;
        }

        if (!passVal || passVal.length < 6) {
          btn.disabled = true;
          showMsg("Password must be at least 6 characters.");
          return;
        }

        btn.disabled = false;
        if (signinMsg) signinMsg.style.display = "none";
      }

      [emailInput, passInput].forEach(
        (el) => el && el.addEventListener("input", validate)
      );

      // allow Enter key
      [emailInput, passInput].forEach(
        (el) =>
          el &&
          el.addEventListener("keydown", function (e) {
            if (e.key === "Enter") {
              e.preventDefault();
              if (!btn.disabled) btn.click();
            }
          })
      );

      btn.addEventListener("click", function () {
        if (btn.disabled) return;
        try {
          const raw = localStorage.getItem("fitmap_user");
          if (!raw) {
            showMsg("No account found. Please sign up first.");
            return;
          }
          const user = JSON.parse(raw);
          const email = emailInput ? emailInput.value.trim() : "";
          const pass = passInput ? passInput.value.trim() : "";

          if (!user.email || user.email.toLowerCase() !== email.toLowerCase()) {
            showMsg("We can't find an account with that email.");
            return;
          }

          if (user.password !== pass) {
            showMsg("Email or password is incorrect.");
            return;
          }

          // success
          window.location.href = "homepage.html";
        } catch (e) {
          showMsg("An error occurred. Try again.");
        }
      });

      validate();
    });
  </script>
</html>
