<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      rel="stylesheet"
      href="../Assets/fontawesome-free-7.0.0-web/css/all.css"
    />
    <link rel="stylesheet" href="../style.css" />
  </head>
  <body>
    <section>
      <div class="login-page">
        <div class="sign-in">
          <img
            class="lo-gos"
            src="../Assets/images/Rectangle 1.png"
            alt="Image"
          />
          <p class="lo-gos-name">Fit Map</p>
          <p id="sign-in-text">Sign into your Account</p>
        </div>

        <div>
          <div class="login-wrap">
            <label class="login-name" data-i18n="your_email">Email</label>
          </div>
          <div>
            <input
              class="login-p-text"
              type="email"
              data-i18n="your_email"
              placeholder="solotech283@gmail.com"
            />
          </div>
        </div>

        <div>
          <div>
            <label class="login-p-name" data-i18n="password">Password</label>
          </div>

          <div>
            <input
              class="login-p-text"
              type="password"
              data-i18n="password"
              placeholder="********"
            />
          </div>
        </div>

        <div class="login-checks">
          <a href="forgotpass.html"
            ><div class="labels">Forgot Password</div></a
          >
        </div>

        <div class="signin">
          <div class="sign-in-btn">
            <button id="signinBtn" disabled data-i18n="save_changes">
              Sign In
            </button>
          </div>
        </div>
        <p
          id="signinMsg"
          class="validation-msg"
          style="
            display: none;
            color: #666;
            font-family: poppins;
            font-size: 0.9rem;
            margin-top: 8px;
          "
          aria-live="polite"
        >
          Please enter your name and password to enable Sign In.
        </p>

        <div class="create-account">
          <div class="account-line"></div>
          <p class="account-text">Or Create account with</p>
        </div>

        <div>
          <div class="btn-wrap">
            <button><i class="fab fa-apple"></i>Apple</button>
            <button class="icon-btn">
              <img
                class="icon"
                src="../Assets/Icons/icons8-google-48.png"
                alt="#"
              />
              Google
            </button>
          </div>

          <div class="last-text">
            <p>Don't have an Account? <a href="sign-up.html">Create One</a></p>
          </div>
        </div>
      </div>
    </section>
  </body>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const inputs = Array.from(document.querySelectorAll(".login-page input"));
      const btn = document.getElementById("signinBtn");
      const signinMsg = document.getElementById("signinMsg");

      function validate() {
        const emailInput = inputs.find((i) => i.type === "email");
        const passInput = inputs.find((i) => i.type === "password");
        const emailVal = emailInput ? emailInput.value.trim() : "";
        const passVal = passInput ? passInput.value.trim() : "";
        const emailFormatOk = /^\S+@\S+\.\S+$/.test(emailVal);

        // Load stored user
        let stored = null;
        try {
          const raw = localStorage.getItem("fitmap_user");
          stored = raw ? JSON.parse(raw) : null;
        } catch (e) {
          stored = null;
        }

        if (!stored) {
          btn.disabled = true;
          if (signinMsg) {
            signinMsg.style.display = "block";
            signinMsg.style.color = "red";
            signinMsg.textContent = "No account found. Please sign up first.";
          }
          return;
        }

        if (!emailFormatOk) {
          btn.disabled = true;
          if (signinMsg) {
            signinMsg.style.display = "block";
            signinMsg.style.color = "red";
            signinMsg.textContent = "Enter a valid email address.";
          }
          return;
        }

        if (emailVal.toLowerCase() !== (stored.email || "").toLowerCase()) {
          btn.disabled = true;
          if (signinMsg) {
            signinMsg.style.display = "block";
            signinMsg.style.color = "red";
            signinMsg.textContent = "We can't find an account with that email.";
          }
          return;
        }

        if (!passVal || passVal.length < 6) {
          btn.disabled = true;
          if (signinMsg) {
            signinMsg.style.display = "block";
            signinMsg.style.color = "red";
            signinMsg.textContent = "Password must be at least 6 characters.";
          }
          return;
        }

        // all checks passed
        btn.disabled = false;
        if (signinMsg) signinMsg.style.display = "none";
      }

      inputs.forEach((i) => i.addEventListener("input", validate));

      btn.addEventListener("click", function () {
        if (btn.disabled) return;
        try {
          const raw = localStorage.getItem("fitmap_user");
          if (!raw) {
            signinMsg.style.display = "block";
            signinMsg.style.color = "red";
            signinMsg.textContent = "No account found. Please sign up first.";
            return;
          }
          const user = JSON.parse(raw);
          const emailInput = inputs.find((i) => i.type === "email");
          const passInput = inputs.find((i) => i.type === "password");
          const email = emailInput ? emailInput.value.trim() : "";
          const pass = passInput ? passInput.value.trim() : "";

          if (!user.email || user.email.toLowerCase() !== email.toLowerCase()) {
            signinMsg.style.display = "block";
            signinMsg.style.color = "red";
            signinMsg.textContent = "We can't find an account with that email.";
            return;
          }

          if (user.password !== pass) {
            signinMsg.style.display = "block";
            signinMsg.style.color = "red";
            signinMsg.textContent = "Email or password is incorrect.";
            return;
          }

          // success
          window.location.href = "homepage.html";
        } catch (e) {
          signinMsg.style.display = "block";
          signinMsg.style.color = "red";
          signinMsg.textContent = "An error occurred. Try again.";
        }
      });

      // Google button intentionally has no action (presentational only)

      validate();
    });
  </script>
</html>
